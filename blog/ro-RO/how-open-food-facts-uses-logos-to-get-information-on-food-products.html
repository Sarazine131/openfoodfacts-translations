How Open Food Facts uses logos to get information on food products

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3><strong>🧂A pinch of context:</strong> “logos” ?</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Open Food Facts is filled with about <strong>3 million products</strong>. Each product has a packaging which is made to attract as many people as possible. To this regard, productors highlight the qualities of their products with<strong> flashy and explicit symbols</strong>. These symbols are numerous and can give information on the brand of the product, its quality, its composition, the way it was made, in which bean to discard it, etc…&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>To homogenize all symbols and help consumers to find products that fit them, <strong>various institutions have created strict rules for producers to be able to mark their products with specific symbols which we call “logos”</strong>. There is thus a huge opportunity 🔥 to get data about products by detecting these logos!</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>How should Open Food Facts detect them ? Thanks to a mix between technology and contributors, as always!</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Raphaël Bournhonesque, a former Open Food Facts contributor who is now part of the permanent team and my internship supervisor, had developed in Robotoff* <strong>a system to extract logos from images, convert them into vectors and find the nearest neighbours of each vector.</strong> The goal of finding logos’ neighbours was <strong>to allow contributors to “annotate” (to categorise manually) massive amounts of logos at the same time through a platform, named <a rel="noreferrer noopener" href="https://hunger.openfoodfacts.org/" target="_blank">Hunger Games</a> </strong>😉.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>However, the models and algorithms used back then could not give efficient enough results.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>In September 2022, I, an engineering student, joined the team for an internship of 6 months which would be dedicated to logos, and I worked on refactoring this whole process! 🥳&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:table -->
<figure class="wp-block-table"><table><tbody><tr><td><strong>* What is Robotoff ?</strong><br><a rel="noreferrer noopener" href="https://github.com/openfoodfacts/robotoff" target="_blank">Robotoff</a> is a service developed by contributors to help Open Food Facts data processing. Based on the data already available in the database, the goal is to retrieve as much information as possible on each product and to add them to the db. Currently, the updates made by Robotoff come from images analysis, through Optical Character Recognition or more general Computer Vision models. Some updates are applied automatically to the db but some others need manual validation via questions or Hunger Games.<br><br><em><strong>To know more about Robotoff, take a look <a rel="noreferrer noopener" href="https://github.com/openfoodfacts/robotoff#readme" target="_blank">here</a>!</strong></em> 👀</td></tr></tbody></table></figure>
<!-- /wp:table -->

<!-- wp:heading {"level":3} -->
<h3><strong>🫗 A drizzle of tech: </strong>How does logos processing work exactly ?</h3>
<!-- /wp:heading -->

<!-- wp:heading {"level":4} -->
<h4><em>1️⃣ </em>Extract logos from products images:</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Open Food Facts contributors trained a Machine Learning model to recognize logos in images. We put an image as the input of the model and we receive multiple bounding boxes with corresponding scores and classes. The classes on which the model was trained were “brand” and “label”.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>You can find the code where the model is called here: <a href="https://github.com/openfoodfacts/robotoff/blob/b209707cc062310b51f9886c87ee14be91527644/robotoff/workers/tasks/import_image.py#L325" target="_blank" rel="noreferrer noopener">Robotoff.import_image.py</a>.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>You can try it by using the following API :&nbsp;<a href="https://robotoff.openfoodfacts.net/api/v1/images/predict?image_url=[image_url]&amp;models=universal-logo-detector" target="_blank" rel="noreferrer noopener">https://robotoff.openfoodfacts.net/api/v1/images/predict?image_url=[image_url]&amp;models=universal-logo-detector</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Cu casetele de delimitare, puteți vedea care sunt siglele corespunzătoare cu API: <a href="https://robotoff.openfoodfacts.net/api/v1/images/crop?image_url=[image_url]&amp;y_min=[y_min]&amp;x_min=[x_min]&amp;y_max=[y_max]&amp;x_max=[x_max]" target="_blank" rel="noreferrer noopener">https://robotoff.openfoodfacts.net/api/v1/images/crop?image_url=[image_url]&amp;y_min=[y_min]&amp;x_min=[x_min]&amp;y_max=[y_max]&amp;x_max=[x_max]</a> unde coordonatele sunt în aceeași ordine cu cele returnate de model în casetele de delimitare.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Iată un exemplu de ceea ce se întâmplă atunci când utilizați aceste API-uri cu următoarea imagine:</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://images.openfoodfacts.org/images/products/322/982/012/9488/front_fr.194.400.jpg" target="_blank" rel="noreferrer noopener">https://images.openfoodfacts.org/images/products/322/982/012/9488/front_fr.194.400.jpg</a></p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":3425,"width":806,"height":252,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large is-resized"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Screenshot-2023-02-14-at-14.34.51-1024x321.png" alt="" class="wp-image-3425" width="806" height="252"/></figure>
<!-- /wp:image -->

<!-- wp:heading {"level":4} -->
<h4><em>2️⃣ </em>Convertiți imaginile logo-urilor în Vectori:</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>Acum că putem accesa logo-uri, trebuie să le vectorizam</strong>. Pentru asta, folosim un model pre-antrenat de la OpenAI numit <a href="https://huggingface.co/docs/transformers/model_doc/clip" target="_blank" rel="noreferrer noopener">CLIP</a>. Chiar dacă modelul a fost antrenat inițial pentru a potrivi imaginile cu text, folosim doar partea „vizuală pe computer” a modelului pentru a obține înglobările (=logo-uri încorporate într-un spațiu vectorial) calculate de CLIP pentru fiecare logo.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Avem astfel o imagine de logo ca intrare și un vector cu dimensiunea 512 ca ieșire. Cu cât distanța dintre doi vectori este mai mică, cu atât cele două sigle corespunzătoare sunt mai asemănătoare.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Funcția <a href="https://github.com/openfoodfacts/robotoff/blob/b209707cc062310b51f9886c87ee14be91527644/robotoff/workers/tasks/import_image.py#L398" target="_blank" rel="noreferrer noopener">save_logo_embeddings</a> din Robotoff este responsabilă de aplicarea modelului logo-urilor și de salvarea înglobărilor în baza de date Robotoff postgresql.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Puteți găsi un cod mai explicit <a href="https://github.com/openfoodfacts/openfoodfacts-ai/blob/develop/logo-ann/generation/02_generate_embeddings.py#L108" target="_blank" rel="noreferrer noopener">aici</a> pentru a înțelege cum folosim CLIP pentru a genera încorporarea siglelor.</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":4} -->
<h4><em>3️⃣ </em>Găsiți cei mai apropiați vecini:</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Pentru a găsi cei mai apropiați vecini ai unui logo, folosim un „index” pentru a stoca înglobările. Odată construit acest index, am putea folosi metoda <strong>„forță brută” 💪 care constă în calcularea distanței dintre logo-ul de interogare și toate celelalte sigle ale db și returnarea celor mai apropiate</strong>. Aceasta este metoda cea mai precisă, deoarece ne oferă „adevărații” cei mai apropiați vecini. Cu toate acestea, această metodă este prea lentă pentru a fi aplicată. Timpul necesar pentru extragerea celor mai apropiați vecini pentru fiecare logo atunci când numărul total de sigle este de 2,5 milioane este de aproximativ 3s 😴</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Deoarece aveam nevoie de un timp de căutare mai bun și eram de acord să avem mai puțină precizie, am decis să folosim <strong>o metodă aproximativă</strong>. Cea pe care o folosește Robotoff se numește HNSW (hierarhical navigable small world). Puteți arunca o privire la <a rel="noreferrer noopener" href="https://www.pinecone.io/learn/vector-indexes/" target="_blank">acest articol</a> pentru a înțelege mai bine căutarea vecinilor cei mai apropiați.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Folosind un index HNSW ElasticSearch, Robotoff este acum capabil să caute cei mai apropiați vecini ai fiecărei încorporare printre mai mult de 2,5 milioane de vectori cu o precizie uriașă (mai mult de 90% din cei mai apropiați 100 de vecini returnați sunt printre cei mai apropiați 100 de vecini adevărați) și un timp scurt de căutare mai mic de 100 ms 👏👏👏👏.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Puteți utiliza următorul API pentru a obține cei mai apropiați vecini ai unui logo: <a href="https://robotoff.openfoodfacts.org/api/v1/ann/search/[logo_id]?count=[count]">https://robotoff.openfoodfacts.org/api/v1/ann/search/[logo_id]?count=[count]</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3><strong>🍯 O lingură de contribuții: </strong>Unde se folosește?</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Nicio clasificare automată a logo-ului nu este încă implementată în Robotoff. Tot ce am explicat mai înainte este făcut doar pentru <a href="https://hunger.openfoodfacts.org/">Hunger Games</a>.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Ce este ? Este <strong>o platformă de adnotare </strong>dezvoltată de un colaborator pe nume Alexandre Fauquette care <strong>permite tuturor să răspundă la previziunile de verificare făcute de Robotoff și să clasifice logo-urile</strong>.&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><br>Poți să încerci. O introducere/tutorial rapidă vă va întâmpina și veți putea adnota sigle! 😉<br>Un tutorial video cu „Cum să folosești Jocurile Foamei?” ar trebui să iasă în curând… ⏳</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center","id":3433,"width":505,"height":633,"sizeSlug":"full","linkDestination":"custom"} -->
<figure class="wp-block-image aligncenter size-full is-resized"><a href="hunger.openfoodfacts.org"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Screenshot-2023-02-14-at-14.44.23.png" alt="" class="wp-image-3433" width="505" height="633"/></a><figcaption class="wp-element-caption">Pentru a juca Jocurile Foamei: hunger.openfoodfacts.org</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>Adnotarea siglelor îmbunătățește Open Food Facts pe măsură ce crește cantitatea de date pe care o avem despre produse și calitatea acestora.</strong> Și datorită modelelor și algoritmilor folosiți în fundal, puteți fi mult mai puternic și puteți avea un impact mai mare asupra alimentației zilnice a oamenilor 🥰.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Articol de Gabriel</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"left","id":3418,"width":167,"height":167,"sizeSlug":"full","linkDestination":"none"} -->
<figure class="wp-block-image alignleft size-full is-resized"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Gabriel.png" alt="" class="wp-image-3418" width="167" height="167"/></figure>
<!-- /wp:image -->
